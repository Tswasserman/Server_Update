<script>
  // Read parameters from URL
  const urlParams = new URLSearchParams(window.location.search);
  const duration = parseInt(urlParams.get('duration')) || 20;
  const mode = urlParams.get('mode') || 'download';

  const progress = document.getElementById("progress");
  const status = document.getElementById("status");
  const eta = document.getElementById("eta");
  const filesize = document.getElementById("filesize");
  const complete = document.getElementById("complete");
  const spinner = document.getElementById("spinner");
  const log = document.getElementById("log");

  let elapsed = 0;
  let totalSize = 500; // MB
  let rate = totalSize / duration;
  if (rate > 50) rate = 50; // cap at 50 MB/sec

  status.innerText = mode === "download" ? "Downloading..." : "Updating...";
  eta.innerText = "ETA: " + duration + "s";

  const interval = setInterval(() => {
    elapsed++;
    let percent = Math.min((elapsed / duration) * 100, 100);
    progress.style.width = percent + "%";
    eta.innerText = "ETA: " + (duration - elapsed) + "s";

    let currentSize = Math.min(Math.floor(elapsed * rate), totalSize);
    filesize.innerText = currentSize + " MB of " + totalSize + " MB";

    // Use <br> for line breaks in HTML
    log.innerHTML += `[INFO] ${status.innerText}...<br>`;
    log.scrollTop = log.scrollHeight;

    if (elapsed >= duration) {
      clearInterval(interval);
      spinner.style.display = "none";
      eta.innerText = "";
      filesize.innerText = "";
      status.innerText = "";
      complete.innerText = mode === "download" ? "✔ Download Complete!" : "✔ Update Complete!";
      log.innerHTML += "[SUCCESS] Operation completed successfully.<br>";
    }
  }, 1000);
</script>
